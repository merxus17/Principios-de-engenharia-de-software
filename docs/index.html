<!DOCTYPE html>
<html lang="en">
<style>
    div{
        align-content: center;
        text-align: center;
    }

    tr, td{
        align-content: center;
        text-align: center;
        vertical-align: middle;
        margin:50px;
    }
</style>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Term Frequency</title>
</head>
<body>
    <div style="font-size: 75px; margin:50px;">
        Principios de engenharia<br>
        <span style="font-size: 65px; margin:50px;">Frequencia de termos</span>
    </div>
    <div>
    <tr>
        <td>Select a File to Load:</td>
        <td><input type="file" id="fileToLoad"></td>
        <td><button onclick="loadFileAsText()">Load Selected File</button><td>
    </tr>
    </div>

    <div><button onclick="parseFile()" style="margin:50px;color:blue;text-align:center;">Parse File!</button></div>
   
    <div id="inputTextToSave">
    </div>
<script>
function extractWords(file){
    var words = file.split(/\s+/)
    if(words.length < 25){
        window.alert("OMG! Less than 25 words! I QUIT!");
        throw new Error("Not enough words");
    }

    for ([index,word] of words.entries()){
        word = word.replace(",", "")
        word = word.replace(".", "")
        word = word.replace("!", "")
        word = word.replace("?", "")
        word = word.replace(";", "")
        word = word.trim()
        words[index] = word.toLowerCase()

    }
    console.log(words)
    return words;

}

function frequencies(wordList){
    var wordFrequencies = new Map();
    for (word of wordList){
        nOcorrencias = wordFrequencies.get(word);
        if(nOcorrencias == undefined)
        {
            wordFrequencies.set(word, 1);
        }
        else{
            wordFrequencies.set(word, nOcorrencias+1);
        }
    }
    //console.log(wordFrequencies);
    return wordFrequencies;


}

function sort(wordFrequencies)
{
    //     assert(type(wordFrequencies) is dict), "I need a dictionary! I quit!"
    //     assert(wordFrequencies != {}), "I need a non-empty dictionary! I quit!"
    
    //     return sorted(wordFrequencies.items(), key=operator.itemgetter(1), reverse=True)
    console.log(typeof(wordFrequencies))
    let array = Array.from(wordFrequencies).map(([word, ocurrences]) => ({word, ocurrences}))
    var sorted = array.sort(function(a,b) { return b.ocurrences - a.ocurrences})
    console.log(sorted)
    return sorted
}

function loadFileAsText(){

    var fileToLoad = document.getElementById("fileToLoad").files[0];
    
    var fileReader = new FileReader();
    fileReader.onload = function(fileLoadedEvent){
        var textFromFileLoaded = fileLoadedEvent.target.result;
        //document.getElementById("inputTextToSave").innerHTML = textFromFileLoaded;
        document.getElementById("inputTextToSave").value = textFromFileLoaded;
    }
  
    fileReader.readAsText(fileToLoad, "UTF-8");
}

function parseFile()
{   
    //window.alert("testando")
    var text = document.getElementById("inputTextToSave").value
    console.log(typeof(text))
    if(typeof text != 'string')
    {
        window.alert("I need a string! I quit!");
        throw new Error("Not a String");
    }
    if(text.length < 1){
        window.alert("I need a non-empty string! I quit!");
        throw new Error("String Empty");
    }
    //console.log(text.length)
    //window.alert(text.length)
    output = frequencies(extractWords(text))
    var sortedWords = sort(output)
    var element = document.getElementById("inputTextToSave");
    alert("deveria limpar")
    element.innerHTML = "";
    var n = 0;
    for (word of sortedWords){
        if(n < 25)
        {
            console.log(word.word)
            var text = document.createTextNode("Palavras: " + word.word + "  => Ocorrencias: " + word.ocurrences);
            var br = document.createElement("br");
            element.appendChild(text);
            element.appendChild(br);
            n++;
        }
        else{
            break;
        }

    }
    //document.getElementById("inputTextToSave").innerHTML = text;
}
</script>    
<!--<script src="../javascript/termFrequency.js" type="text/javascript"></script>  nÃ£o funciona no git hub pages -->
</body>
</html>